#! /usr/bin/bash

# copy from plots
rsync -av _org/plots/ assets/img/

# convert the file path in the markdowns
# and move the markdown from _org to _post
# assuming markdown is already generated by the org files, which needs to be done first in emacs
find _org/*md -exec sh -c 'sed "s/\.\/plots/\.\.\/assets\/img/g" $1 | sed '"'"'s/\$/\$\$/g'"'"' > "$1_pupdate.md" && rm $1 && mv $1_pupdate.md _posts/${1##*/}' sh {} \;


# # copy the md files
# # update: already done in the above one-liner
# rsync -av _org/*md _posts/

# # remove the md, so in the future sed won't cause new rsync copies
# # update: already done in the above one-liner
# rm _org/*md


# # preview
# jekyll bundle build
bundle exec jekyll build
# since in ruby >=3.0 jekyll serve won't work without tweaking, serve with python
cd _site && python -m http.server 4000
